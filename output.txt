╔═══════════════════════════════════════════════════════╗
║     DUAL-CLOCK FIFO TESTBENCH WITH CDC ANALYSIS       ║
╚═══════════════════════════════════════════════════════╝

Configuration:
  Buffer Depth: 16
  Data Width: 32 bits
  Write Clock: 100.0 MHz
  Read Clock: 66.7 MHz
  Synchronizer stages: 2


[CREDIT] Time=45000, Credits: x -> 10 (Change: x)

=== RESET COMPLETE ===


========================================
TEST: Burst Transfers
========================================

Writing 30 items with random gaps...
[WRITE] Time=205000, Data=0x12153524, Ptr=0, Credits=10
[WRITE] Time=225000, Data=0xc0895e81, Ptr=1, Credits=9
[CREDIT] Time=225000, Credits: 10 -> 9 (Change: -1)
[WRITE] Time=245000, Data=0x8484d609, Ptr=2, Credits=8
[CREDIT] Time=245000, Credits: 9 -> 8 (Change: -1)
[WRITE] Time=265000, Data=0xb1f05663, Ptr=3, Credits=7
[CREDIT] Time=265000, Credits: 8 -> 7 (Change: -1)
[CREDIT] Time=285000, Credits: 7 -> 6 (Change: -1)
[WRITE] Time=295000, Data=0x06b97b0d, Ptr=4, Credits=6
[WRITE] Time=315000, Data=0x46df998d, Ptr=5, Credits=5
[CREDIT] Time=315000, Credits: 6 -> 5 (Change: -1)
[CREDIT] Time=335000, Credits: 5 -> 4 (Change: -1)
[WRITE] Time=345000, Data=0xb2c28465, Ptr=6, Credits=4
[WRITE] Time=365000, Data=0x89375212, Ptr=7, Credits=3
[CREDIT] Time=365000, Credits: 4 -> 3 (Change: -1)
[WRITE] Time=385000, Data=0x00f3e301, Ptr=8, Credits=2
[CREDIT] Time=385000, Credits: 3 -> 2 (Change: -1)
[WRITE] Time=405000, Data=0x06d7cd0d, Ptr=9, Credits=1
[CREDIT] Time=405000, Credits: 2 -> 1 (Change: -1)
[CREDIT] Time=425000, Credits: 1 -> 0 (Change: -1)
Reading 30 items with random gaps...
[READ OK] Time=2228000, Data=0x12153524, Ptr=1
[READ OK] Time=2243000, Data=0xc0895e81, Ptr=2
[CREDIT] Time=2245000, Credits: 0 -> 1 (Change: 1)
[READ OK] Time=2258000, Data=0x8484d609, Ptr=3
[CREDIT] Time=2265000, Credits: 1 -> 2 (Change: 1)
[READ OK] Time=2273000, Data=0xb1f05663, Ptr=4
[CREDIT] Time=2275000, Credits: 2 -> 3 (Change: 1)
[READ OK] Time=2288000, Data=0x06b97b0d, Ptr=5
[CREDIT] Time=2295000, Credits: 3 -> 4 (Change: 1)
[READ OK] Time=2303000, Data=0x46df998d, Ptr=6
[CREDIT] Time=2305000, Credits: 4 -> 5 (Change: 1)
[READ OK] Time=2318000, Data=0xb2c28465, Ptr=7
[CREDIT] Time=2325000, Credits: 5 -> 6 (Change: 1)
[READ OK] Time=2333000, Data=0x89375212, Ptr=8
[CREDIT] Time=2335000, Credits: 6 -> 7 (Change: 1)
[READ OK] Time=2348000, Data=0x00f3e301, Ptr=9
[CREDIT] Time=2355000, Credits: 7 -> 8 (Change: 1)
[READ OK] Time=2363000, Data=0x06d7cd0d, Ptr=10
[CREDIT] Time=2365000, Credits: 8 -> 9 (Change: 1)
[CREDIT] Time=2385000, Credits: 9 -> 10 (Change: 1)
Burst test complete.


=== RESET COMPLETE ===


========================================
TEST: Overflow Protection
========================================

Attempting to write 26 items (more than depth 16)...
[WRITE] Time=32905000, Data=0xb1ef6263, Ptr=0, Credits=10
[WRITE] Time=32925000, Data=0x0573870a, Ptr=1, Credits=9
[CREDIT] Time=32925000, Credits: 10 -> 9 (Change: -1)
[WRITE] Time=32945000, Data=0xc03b2280, Ptr=2, Credits=8
[CREDIT] Time=32945000, Credits: 9 -> 8 (Change: -1)
[WRITE] Time=32965000, Data=0x10642120, Ptr=3, Credits=7
[CREDIT] Time=32965000, Credits: 8 -> 7 (Change: -1)
[WRITE] Time=32985000, Data=0x557845aa, Ptr=4, Credits=6
[CREDIT] Time=32985000, Credits: 7 -> 6 (Change: -1)
[WRITE] Time=33005000, Data=0xcecccc9d, Ptr=5, Credits=5
[CREDIT] Time=33005000, Credits: 6 -> 5 (Change: -1)
[WRITE] Time=33025000, Data=0xcb203e96, Ptr=6, Credits=4
[CREDIT] Time=33025000, Credits: 5 -> 4 (Change: -1)
[WRITE] Time=33045000, Data=0x8983b813, Ptr=7, Credits=3
[CREDIT] Time=33045000, Credits: 4 -> 3 (Change: -1)
[WRITE] Time=33065000, Data=0x86bc380d, Ptr=8, Credits=2
[CREDIT] Time=33065000, Credits: 3 -> 2 (Change: -1)
[WRITE] Time=33085000, Data=0xa9a7d653, Ptr=9, Credits=1
[CREDIT] Time=33085000, Credits: 2 -> 1 (Change: -1)
[CREDIT] Time=33105000, Credits: 1 -> 0 (Change: -1)
✓ PASS: Buffer correctly stopped accepting writes
  Final credits: 0
Flushing buffer...
[READ OK] Time=33953000, Data=0xb1ef6263, Ptr=1
[READ OK] Time=33968000, Data=0x0573870a, Ptr=2
[CREDIT] Time=33975000, Credits: 0 -> 1 (Change: 1)
[READ OK] Time=33983000, Data=0xc03b2280, Ptr=3
[CREDIT] Time=33985000, Credits: 1 -> 2 (Change: 1)
[READ OK] Time=33998000, Data=0x10642120, Ptr=4
[CREDIT] Time=34005000, Credits: 2 -> 3 (Change: 1)
[READ OK] Time=34013000, Data=0x557845aa, Ptr=5
[CREDIT] Time=34015000, Credits: 3 -> 4 (Change: 1)
[READ OK] Time=34028000, Data=0xcecccc9d, Ptr=6
[CREDIT] Time=34035000, Credits: 4 -> 5 (Change: 1)
[READ OK] Time=34043000, Data=0xcb203e96, Ptr=7
[CREDIT] Time=34045000, Credits: 5 -> 6 (Change: 1)
[READ OK] Time=34058000, Data=0x8983b813, Ptr=8
[CREDIT] Time=34065000, Credits: 6 -> 7 (Change: 1)
[READ OK] Time=34073000, Data=0x86bc380d, Ptr=9
[CREDIT] Time=34075000, Credits: 7 -> 8 (Change: 1)
[READ OK] Time=34088000, Data=0xa9a7d653, Ptr=10
[CREDIT] Time=34095000, Credits: 8 -> 9 (Change: 1)
[CREDIT] Time=34105000, Credits: 9 -> 10 (Change: 1)

=== RESET COMPLETE ===


========================================
TEST: CDC Latency Analysis
========================================

Step 1: Writing 11 items to partially fill buffer...
[WRITE] Time=35835000, Data=0x75c50deb, Ptr=0, Credits=10
[WRITE] Time=35855000, Data=0x5b0265b6, Ptr=1, Credits=9
[CREDIT] Time=35855000, Credits: 10 -> 9 (Change: -1)
[WRITE] Time=35875000, Data=0x634bf9c6, Ptr=2, Credits=8
[CREDIT] Time=35875000, Credits: 9 -> 8 (Change: -1)
[WRITE] Time=35895000, Data=0x571513ae, Ptr=3, Credits=7
[CREDIT] Time=35895000, Credits: 8 -> 7 (Change: -1)
[WRITE] Time=35915000, Data=0xde7502bc, Ptr=4, Credits=6
[CREDIT] Time=35915000, Credits: 7 -> 6 (Change: -1)
[WRITE] Time=35935000, Data=0x150fdd2a, Ptr=5, Credits=5
[CREDIT] Time=35935000, Credits: 6 -> 5 (Change: -1)
[WRITE] Time=35955000, Data=0x85d79a0b, Ptr=6, Credits=4
[CREDIT] Time=35955000, Credits: 5 -> 4 (Change: -1)
[WRITE] Time=35975000, Data=0xb897be71, Ptr=7, Credits=3
[CREDIT] Time=35975000, Credits: 4 -> 3 (Change: -1)
[WRITE] Time=35995000, Data=0x42f24185, Ptr=8, Credits=2
[CREDIT] Time=35995000, Credits: 3 -> 2 (Change: -1)
[WRITE] Time=36015000, Data=0x27f2554f, Ptr=9, Credits=1
[CREDIT] Time=36015000, Credits: 2 -> 1 (Change: -1)
[CREDIT] Time=36035000, Credits: 1 -> 0 (Change: -1)
Credits after partial fill: 0
Expected credits: ~5

Step 2: Writing continuously until credits exhausted...
Writes completed before credit exhaustion: 0
Final credits: 0
Write pointer: 10, Read pointer: 0

Step 3: Reading to return credits...
[READ OK] Time=36683000, Data=0x75c50deb, Ptr=1
[READ OK] Time=36698000, Data=0x5b0265b6, Ptr=2
  [CDC] Credits returned! Credits=1 at time=36705000
[CREDIT] Time=36705000, Credits: 0 -> 1 (Change: 1)
[READ OK] Time=36713000, Data=0x634bf9c6, Ptr=3
  [CDC] Credits returned! Credits=2 at time=36715000
[CREDIT] Time=36715000, Credits: 1 -> 2 (Change: 1)
  [CDC] Credits returned! Credits=2 at time=36725000
[READ OK] Time=36728000, Data=0x571513ae, Ptr=4
  [CDC] Credits returned! Credits=3 at time=36735000
[CREDIT] Time=36735000, Credits: 2 -> 3 (Change: 1)
[READ OK] Time=36743000, Data=0xde7502bc, Ptr=5
  [CDC] Credits returned! Credits=4 at time=36745000
[CREDIT] Time=36745000, Credits: 3 -> 4 (Change: 1)
  [CDC] Credits returned! Credits=4 at time=36755000
[READ OK] Time=36758000, Data=0x150fdd2a, Ptr=6
  [CDC] Credits returned! Credits=5 at time=36765000
[CREDIT] Time=36765000, Credits: 4 -> 5 (Change: 1)
[READ OK] Time=36773000, Data=0x85d79a0b, Ptr=7
  [CDC] Credits returned! Credits=6 at time=36775000
[CREDIT] Time=36775000, Credits: 5 -> 6 (Change: 1)
  [CDC] Credits returned! Credits=6 at time=36785000
[READ OK] Time=36788000, Data=0xb897be71, Ptr=8
  [CDC] Credits returned! Credits=7 at time=36795000
[CREDIT] Time=36795000, Credits: 6 -> 7 (Change: 1)
[READ OK] Time=36803000, Data=0x42f24185, Ptr=9
  [CDC] Credits returned! Credits=8 at time=36805000
[CREDIT] Time=36805000, Credits: 7 -> 8 (Change: 1)
  [CDC] Credits returned! Credits=8 at time=36815000
[READ OK] Time=36818000, Data=0x27f2554f, Ptr=10
  [CDC] Credits returned! Credits=9 at time=36825000
[CREDIT] Time=36825000, Credits: 8 -> 9 (Change: 1)
  [CDC] Credits returned! Credits=10 at time=36835000
[CREDIT] Time=36835000, Credits: 9 -> 10 (Change: 1)
  [CDC] Credits returned! Credits=10 at time=36845000
  [CDC] Credits returned! Credits=10 at time=36855000
  [CDC] Credits returned! Credits=10 at time=36865000
  [CDC] Credits returned! Credits=10 at time=36875000
  [CDC] Credits returned! Credits=10 at time=36885000
  [CDC] Credits returned! Credits=10 at time=36895000
  [CDC] Credits returned! Credits=10 at time=36905000
  [CDC] Credits returned! Credits=10 at time=36915000
  [CDC] Credits returned! Credits=10 at time=36925000
  [CDC] Credits returned! Credits=10 at time=36935000
  [CDC] Credits returned! Credits=10 at time=36945000
  [CDC] Credits returned! Credits=10 at time=36955000
Final credits after reads: 10


=== RESET COMPLETE ===


========================================
TEST: Wraparound Scenario
Buffer depth = 16
========================================

Step 1: Filling buffer close to wraparound...
[WRITE] Time=38865000, Data=0x061d7f0c, Ptr=0, Credits=10
[WRITE] Time=38885000, Data=0xe12ccec2, Ptr=1, Credits=9
[CREDIT] Time=38885000, Credits: 10 -> 9 (Change: -1)
[WRITE] Time=38905000, Data=0x6457edc8, Ptr=2, Credits=8
[CREDIT] Time=38905000, Credits: 9 -> 8 (Change: -1)
[WRITE] Time=38925000, Data=0xbb825a77, Ptr=3, Credits=7
[CREDIT] Time=38925000, Credits: 8 -> 7 (Change: -1)
[WRITE] Time=38945000, Data=0x1ef2ed3d, Ptr=4, Credits=6
[CREDIT] Time=38945000, Credits: 7 -> 6 (Change: -1)
[WRITE] Time=38965000, Data=0x090cdb12, Ptr=5, Credits=5
[CREDIT] Time=38965000, Credits: 6 -> 5 (Change: -1)
[WRITE] Time=38985000, Data=0xbf05007e, Ptr=6, Credits=4
[CREDIT] Time=38985000, Credits: 5 -> 4 (Change: -1)
[WRITE] Time=39005000, Data=0x36e5816d, Ptr=7, Credits=3
[CREDIT] Time=39005000, Credits: 4 -> 3 (Change: -1)
[WRITE] Time=39025000, Data=0x1cd9e739, Ptr=8, Credits=2
[CREDIT] Time=39025000, Credits: 3 -> 2 (Change: -1)
[WRITE] Time=39045000, Data=0x0fd28f1f, Ptr=9, Credits=1
[CREDIT] Time=39045000, Credits: 2 -> 1 (Change: -1)
[CREDIT] Time=39065000, Credits: 1 -> 0 (Change: -1)
Write pointer at: 10 (next write wraps to 0)

Step 2: Reading 6 items to create space...
[READ OK] Time=39368000, Data=0x061d7f0c, Ptr=1
[READ OK] Time=39383000, Data=0xe12ccec2, Ptr=2
[CREDIT] Time=39385000, Credits: 0 -> 1 (Change: 1)
[READ OK] Time=39398000, Data=0x6457edc8, Ptr=3
[CREDIT] Time=39405000, Credits: 1 -> 2 (Change: 1)
[READ OK] Time=39413000, Data=0xbb825a77, Ptr=4
[CREDIT] Time=39415000, Credits: 2 -> 3 (Change: 1)
[READ OK] Time=39428000, Data=0x1ef2ed3d, Ptr=5
[CREDIT] Time=39435000, Credits: 3 -> 4 (Change: 1)
[READ OK] Time=39443000, Data=0x090cdb12, Ptr=6
[CREDIT] Time=39445000, Credits: 4 -> 5 (Change: 1)
[READ OK] Time=39458000, Data=0xbf05007e, Ptr=7
[CREDIT] Time=39465000, Credits: 5 -> 6 (Change: 1)
[READ OK] Time=39473000, Data=0x36e5816d, Ptr=8
[CREDIT] Time=39475000, Credits: 6 -> 7 (Change: 1)
[READ OK] Time=39488000, Data=0x1cd9e739, Ptr=9
[CREDIT] Time=39495000, Credits: 7 -> 8 (Change: 1)
[READ OK] Time=39503000, Data=0x0fd28f1f, Ptr=10
[CREDIT] Time=39505000, Credits: 8 -> 9 (Change: 1)
[CREDIT] Time=39525000, Credits: 9 -> 10 (Change: 1)
Read pointer now at: 10
Credits available: 10
Physical space: positions 0-5 are free (6 slots)
But with 2-stage sync, safe credits should be ~3-4

Step 3: Writing continuously to test CDC safety margin...
  Write 1: ptr=10, credits=10
[WRITE] Time=42645000, Data=0x248b4b49, Ptr=10, Credits=10
  Write 2: ptr=11, credits=9
[WRITE] Time=42665000, Data=0x9ff2ae3f, Ptr=11, Credits=9
[CREDIT] Time=42665000, Credits: 10 -> 9 (Change: -1)
  Write 3: ptr=12, credits=8
[WRITE] Time=42685000, Data=0x150caf2a, Ptr=12, Credits=8
[CREDIT] Time=42685000, Credits: 9 -> 8 (Change: -1)
  Write 4: ptr=13, credits=7
[WRITE] Time=42705000, Data=0x2c156358, Ptr=13, Credits=7
[CREDIT] Time=42705000, Credits: 8 -> 7 (Change: -1)
  Write 5: ptr=14, credits=6
[WRITE] Time=42725000, Data=0xc33f3886, Ptr=14, Credits=6
[CREDIT] Time=42725000, Credits: 7 -> 6 (Change: -1)
  Write 6: ptr=15, credits=5
[WRITE] Time=42745000, Data=0xc71a0c8e, Ptr=15, Credits=5
[CREDIT] Time=42745000, Credits: 6 -> 5 (Change: -1)
  Write 7: ptr=0, credits=4
[WRITE] Time=42765000, Data=0xce2ff29c, Ptr=0, Credits=4
[CREDIT] Time=42765000, Credits: 5 -> 4 (Change: -1)
  Write 8: ptr=1, credits=3
[WRITE] Time=42785000, Data=0x7d3599fa, Ptr=1, Credits=3
[CREDIT] Time=42785000, Credits: 4 -> 3 (Change: -1)
  Write 9: ptr=2, credits=2
[WRITE] Time=42805000, Data=0x937dbc26, Ptr=2, Credits=2
[CREDIT] Time=42805000, Credits: 3 -> 2 (Change: -1)
  Write 10: ptr=3, credits=1
[WRITE] Time=42825000, Data=0x39961773, Ptr=3, Credits=1
[CREDIT] Time=42825000, Credits: 2 -> 1 (Change: -1)

Results:
  Total safe writes before stop: 10
  Write pointer stopped at: 3
  Read pointer at: 10
  Safety margin: 7 positions

Expected: Stop at position 1-3 (with 2-stage synchronizer)
Actual stop position: 3


Draining remaining buffer contents...
[CREDIT] Time=42845000, Credits: 1 -> 0 (Change: -1)
[READ OK] Time=42863000, Data=0x248b4b49, Ptr=11
[READ OK] Time=42878000, Data=0x9ff2ae3f, Ptr=12
[CREDIT] Time=42885000, Credits: 0 -> 1 (Change: 1)
[READ OK] Time=42893000, Data=0x150caf2a, Ptr=13
[CREDIT] Time=42895000, Credits: 1 -> 2 (Change: 1)
[READ OK] Time=42908000, Data=0x2c156358, Ptr=14
[CREDIT] Time=42915000, Credits: 2 -> 3 (Change: 1)
[READ OK] Time=42923000, Data=0xc33f3886, Ptr=15
[CREDIT] Time=42925000, Credits: 3 -> 4 (Change: 1)
[READ OK] Time=42938000, Data=0xc71a0c8e, Ptr=0
[CREDIT] Time=42945000, Credits: 4 -> 5 (Change: 1)
[READ OK] Time=42953000, Data=0xce2ff29c, Ptr=1
[CREDIT] Time=42955000, Credits: 5 -> 6 (Change: 1)
[READ OK] Time=42968000, Data=0x7d3599fa, Ptr=2
[CREDIT] Time=42975000, Credits: 6 -> 7 (Change: 1)
[READ OK] Time=42983000, Data=0x937dbc26, Ptr=3
[CREDIT] Time=42985000, Credits: 7 -> 8 (Change: 1)
[READ OK] Time=42998000, Data=0x39961773, Ptr=4
[CREDIT] Time=43005000, Credits: 8 -> 9 (Change: 1)
[CREDIT] Time=43015000, Credits: 9 -> 10 (Change: 1)
After drain: Pending items = 0



╔═══════════════════════════════════════════════════════╗
║                    TEST SUMMARY                       ║
╚═══════════════════════════════════════════════════════╝
  Total Writes: 50
  Total Reads: 50
  Errors: 0
  Pending in queue: 0

  ✓✓✓ ALL TESTS PASSED ✓✓✓

$finish called at time : 46325 ns : File "/home/prawns/project_1/project_1.srcs/sim_1/new/buffer_tb.sv" Line 356
INFO: [USF-XSim-96] XSim completed. Design snapshot 'buffer_tb_behav' loaded.
INFO: [USF-XSim-97] XSim simulation ran for 500us
launch_simulation: Time (s): cpu = 00:00:08 ; elapsed = 00:00:08 . Memory (MB): peak = 8490.930 ; gain = 9.008 ; free physical = 837 ; free virtual = 11709